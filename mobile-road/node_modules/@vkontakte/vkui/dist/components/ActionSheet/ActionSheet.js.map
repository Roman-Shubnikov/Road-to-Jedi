{"version":3,"sources":["../../../src/components/ActionSheet/ActionSheet.tsx"],"names":["React","Component","PopoutWrapper","transitionEvent","withPlatform","withAdaptivity","ViewWidth","ANDROID","IOS","VKCOM","ActionSheetDropdownDesktop","ActionSheetDropdown","hasReactNode","ActionSheetContext","Caption","ActionSheet","props","closing","setState","waitTransitionFinish","onClose","action","autoclose","event","persist","elRef","createRef","eventHandler","viewWidth","TABLET","supported","current","removeEventListener","name","addEventListener","clearTimeout","transitionFinishTimeout","setTimeout","platform","children","className","header","text","style","iosCloseItem","restProps","isDesktop","DropdownComponent","state","onItemClick"],"mappings":"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","sourcesContent":["import React, { Component, HTMLAttributes } from 'react';\nimport PopoutWrapper from '../PopoutWrapper/PopoutWrapper';\nimport { transitionEvent } from '../../lib/supportEvents';\nimport withPlatform from '../../hoc/withPlatform';\nimport withAdaptivity, { AdaptivityProps, ViewWidth } from '../../hoc/withAdaptivity';\nimport { HasPlatform } from '../../types';\nimport { ANDROID, IOS, VKCOM } from '../../lib/platform';\nimport ActionSheetDropdownDesktop from './ActionSheetDropdownDesktop';\nimport ActionSheetDropdown from './ActionSheetDropdown';\nimport { hasReactNode } from '../../lib/utils';\nimport { ActionSheetContext, ItemClickHandler } from './ActionSheetContext';\nimport Caption from '../Typography/Caption/Caption';\n\nexport interface ActionSheetProps extends HTMLAttributes<HTMLDivElement>, HasPlatform, AdaptivityProps {\n  header?: React.ReactNode;\n  text?: React.ReactNode;\n  onClose(): void;\n  /**\n   * Desktop only\n   */\n  toggleRef: Element;\n  iosCloseItem: React.ReactNode;\n}\n\nexport interface ActionSheetState {\n  closing: boolean;\n}\n\nexport type CloseCallback = () => void;\n\nexport type AnimationEndCallback = (e?: AnimationEvent) => void;\n\nclass ActionSheet extends Component<ActionSheetProps, ActionSheetState> {\n  constructor(props: ActionSheetProps) {\n    super(props);\n    this.elRef = React.createRef();\n  }\n\n  state: ActionSheetState = {\n    closing: false,\n  };\n\n  elRef: React.RefObject<HTMLDivElement>;\n\n  private transitionFinishTimeout: ReturnType<typeof setTimeout>;\n\n  onClose: CloseCallback = () => {\n    this.setState({ closing: true });\n    this.waitTransitionFinish(this.props.onClose);\n  };\n\n  onItemClick: ItemClickHandler = (action, autoclose) => (event) => {\n    event.persist();\n\n    if (autoclose) {\n      this.setState({ closing: true });\n      this.waitTransitionFinish(() => {\n        this.props.onClose();\n        action && action(event);\n      });\n    } else {\n      action && action(event);\n    }\n  };\n\n  waitTransitionFinish(eventHandler: AnimationEndCallback) {\n    if (this.props.viewWidth >= ViewWidth.TABLET) {\n      eventHandler();\n    }\n\n    if (transitionEvent.supported) {\n      this.elRef.current.removeEventListener(transitionEvent.name, eventHandler);\n      this.elRef.current.addEventListener(transitionEvent.name, eventHandler);\n    } else {\n      clearTimeout(this.transitionFinishTimeout);\n      this.transitionFinishTimeout = setTimeout(eventHandler, this.props.platform === ANDROID || this.props.platform === VKCOM ? 200 : 300);\n    }\n  }\n\n  render() {\n    const {\n      children,\n      className,\n      header,\n      text,\n      style,\n      platform,\n      viewWidth,\n      iosCloseItem,\n      ...restProps\n    } = this.props;\n\n    const isDesktop = viewWidth >= ViewWidth.TABLET;\n\n    const DropdownComponent = isDesktop\n      ? ActionSheetDropdownDesktop\n      : ActionSheetDropdown;\n\n    return (\n      <PopoutWrapper\n        closing={this.state.closing}\n        alignY=\"bottom\"\n        className={className}\n        style={style}\n        onClick={this.onClose}\n        hasMask={!isDesktop}\n        fixed={!isDesktop}\n      >\n        <ActionSheetContext.Provider\n          value={{\n            onItemClick: this.onItemClick,\n            isDesktop,\n          }}>\n          <DropdownComponent\n            closing={this.state.closing}\n            onClose={this.onClose}\n            elementRef={this.elRef}\n            {...restProps}\n          >\n            {(hasReactNode(header) || hasReactNode(text)) &&\n              <header className=\"ActionSheet__header\">\n                {hasReactNode(header) &&\n                  <Caption level=\"1\" weight={platform === IOS ? 'semibold' : 'medium'} className=\"ActionSheet__title\">\n                    {header}\n                  </Caption>\n                }\n                {hasReactNode(text) && <Caption level=\"1\" weight=\"regular\" className=\"ActionSheet__text\">{text}</Caption>}\n              </header>\n            }\n            {children}\n            {platform === IOS && !isDesktop && iosCloseItem}\n          </DropdownComponent>\n        </ActionSheetContext.Provider>\n      </PopoutWrapper>\n    );\n  }\n}\n\nexport default withAdaptivity(withPlatform(ActionSheet), {\n  viewWidth: true,\n});\n"],"file":"ActionSheet.js"}