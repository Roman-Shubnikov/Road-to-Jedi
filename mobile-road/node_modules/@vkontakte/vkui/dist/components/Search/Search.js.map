{"version":3,"sources":["../../../src/components/Search/Search.tsx"],"names":["React","Component","classNames","withPlatform","getClassname","Icon16SearchOutline","Icon16Clear","Icon24Cancel","IOS","VKCOM","Touch","setRef","Text","Separator","searchId","Search","props","e","setState","focused","onFocus","onBlur","target","isControlledOutside","value","onChange","nativeInputValueSetter","Object","getOwnPropertyDescriptor","window","HTMLInputElement","prototype","set","call","inputEl","ev2","Event","bubbles","dispatchEvent","onIconClick","originalEvent","preventDefault","focus","onCancel","element","getRef","state","hasOwnProperty","defaultValue","before","className","placeholder","after","platform","icon","inputProps","inputRef","onIconClickStart","onIconCancelClickStart","autoComplete"],"mappings":"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","sourcesContent":["import React, {\n  Component,\n  ReactNode,\n  FocusEvent,\n  FocusEventHandler,\n  InputHTMLAttributes,\n  ChangeEvent,\n  ChangeEventHandler,\n} from 'react';\nimport classNames from '../../lib/classNames';\nimport withPlatform from '../../hoc/withPlatform';\nimport getClassname from '../../helpers/getClassName';\nimport { Icon16SearchOutline, Icon16Clear, Icon24Cancel } from '@vkontakte/icons';\nimport { IOS, VKCOM } from '../../lib/platform';\nimport { HasPlatform, HasRef } from '../../types';\nimport Touch, { TouchEventHandler, TouchEvent } from '../Touch/Touch';\nimport { VKUITouchEvent } from '../../lib/touch';\nimport { setRef } from '../../lib/utils';\nimport Text from '../Typography/Text/Text';\nimport { Separator } from '../../index';\n\nlet searchId = 0;\n\nexport type InputRef = (element: HTMLInputElement) => void;\n\nexport interface SearchProps extends InputHTMLAttributes<HTMLInputElement>, HasRef<HTMLInputElement>, HasPlatform {\n  /**\n   * iOS only. Текст кнопки \"отмена\", которая чистит текстовое поле и убирает фокус.\n   */\n  after?: ReactNode;\n  before?: ReactNode;\n  icon?: ReactNode;\n  onIconClick?: (e: VKUITouchEvent) => void;\n  defaultValue?: string;\n}\n\nexport interface SearchState {\n  value?: string;\n  focused?: boolean;\n}\n\nclass Search extends Component<SearchProps, SearchState> {\n  static defaultProps: SearchProps = {\n    autoComplete: 'off',\n    placeholder: 'Поиск',\n    after: 'Отмена',\n    before: <Icon16SearchOutline />,\n  };\n\n  isControlledOutside: boolean;\n\n  inputEl: HTMLInputElement;\n\n  searchId: string;\n\n  constructor(props: SearchProps) {\n    super(props);\n\n    const state: SearchState = {\n      focused: false,\n    };\n\n    if (props.hasOwnProperty('value')) {\n      this.isControlledOutside = true;\n    } else {\n      state.value = props.defaultValue || '';\n    }\n    this.searchId = `search-${searchId++}`;\n    this.state = state;\n  }\n\n  get value() {\n    return this.isControlledOutside ? this.props.value : this.state.value;\n  }\n\n  onFocus: FocusEventHandler = (e: FocusEvent<HTMLInputElement>) => {\n    this.setState({ focused: true });\n    this.props.onFocus && this.props.onFocus(e);\n  };\n\n  onBlur: FocusEventHandler = (e: FocusEvent<HTMLInputElement>) => {\n    this.setState({ focused: false });\n    this.props.onBlur && this.props.onBlur(e);\n  };\n\n  onChange: ChangeEventHandler = (e?: ChangeEvent<HTMLInputElement>) => {\n    const target = e.target as HTMLInputElement;\n    if (!this.isControlledOutside) {\n      this.setState({ value: target.value });\n    }\n    if (this.props.onChange) {\n      this.props.onChange(e);\n    }\n  };\n\n  onCancel: VoidFunction = () => {\n    // eslint-disable-next-line @typescript-eslint/unbound-method\n    const nativeInputValueSetter = Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype, 'value').set;\n    nativeInputValueSetter.call(this.inputEl, '');\n\n    const ev2 = new Event('input', { bubbles: true });\n    this.inputEl.dispatchEvent(ev2);\n  };\n\n  onIconClickStart: TouchEventHandler = (e: TouchEvent) => {\n    this.props.onIconClick && this.props.onIconClick(e.originalEvent);\n  };\n\n  onIconCancelClickStart: TouchEventHandler = (e: TouchEvent) => {\n    e.originalEvent.preventDefault();\n    this.inputEl.focus();\n    this.onCancel();\n  };\n\n  inputRef: InputRef = (element: HTMLInputElement) => {\n    this.inputEl = element;\n    setRef(element, this.props.getRef);\n  };\n\n  render() {\n    const {\n      before,\n      className,\n      onFocus,\n      onBlur,\n      onChange,\n      defaultValue,\n      value,\n      placeholder,\n      after,\n      getRef,\n      platform,\n      icon,\n      onIconClick,\n      ...inputProps\n    } = this.props;\n\n    return (\n      <div className={classNames(getClassname('Search', platform), {\n        'Search--focused': this.state.focused,\n        'Search--has-value': !!this.value,\n        'Search--has-after': !!after,\n        'Search--has-icon': !!icon,\n      }, className)}>\n        <div className=\"Search__in\">\n          <div className=\"Search__width\" />\n          <label className=\"Search__control\">\n            <input\n              {...inputProps}\n              ref={this.inputRef}\n              type=\"text\"\n              className=\"Search__input\"\n              onFocus={this.onFocus}\n              onBlur={this.onBlur}\n              onChange={this.onChange}\n              value={this.value}\n            />\n            {platform === IOS && after && <div className=\"Search__after-width\">{after}</div>}\n            <div className=\"Search__placeholder\">\n              <div className=\"Search__placeholder-in\">\n                {before}\n                <div className=\"Search__placeholder-text\">\n                  {platform === VKCOM ? <Text weight=\"regular\">{placeholder}</Text> : placeholder}\n                </div>\n              </div>\n              {this.state.focused && platform === IOS && after && <div className=\"Search__after-width\">{after}</div>}\n            </div>\n          </label>\n          <div className=\"Search__after\" onClick={this.onCancel}>\n            <div className=\"Search__icons\">\n              {icon &&\n                <Touch onStart={this.onIconClickStart} className=\"Search__icon\">\n                  {icon}\n                </Touch>\n              }\n              {!!this.value &&\n                <Touch onStart={this.onIconCancelClickStart} className=\"Search__icon\">\n                  {platform === VKCOM ?\n                    <Icon24Cancel />\n                    :\n                    <Icon16Clear />\n                  }\n                </Touch>\n              }\n            </div>\n            {platform === IOS && after &&\n              <div className=\"Search__after-in\">{after}</div>\n            }\n          </div>\n        </div>\n        {platform === VKCOM && <Separator className=\"Search__separator\" wide />}\n      </div>\n    );\n  }\n}\n\nexport default withPlatform(Search);\n"],"file":"Search.js"}