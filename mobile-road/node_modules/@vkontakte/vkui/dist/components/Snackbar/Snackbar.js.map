{"version":3,"sources":["../../../src/components/Snackbar/Snackbar.tsx"],"names":["React","PureComponent","PropTypes","withPlatform","FixedLayout","Touch","classNames","getClassname","canUseDOM","transitionEvent","ANDROID","VKCOM","rubber","withAdaptivity","ViewWidth","Text","Button","AppRootPortal","Snackbar","props","closeTimeout","setTimeout","close","duration","clearTimeout","e","action","onActionClick","el","innerEl","clearCloseTimeout","event","shiftX","startT","originalEvent","preventDefault","state","touched","setState","shiftXPercent","bodyElRef","current","offsetWidth","shiftXCurrent","platform","touchStartTime","setBodyTransform","newState","callback","expectTranslateY","Date","now","getTime","isDesktop","waitTransitionFinish","onClose","setCloseTimeout","closing","createRef","element","eventHandler","supported","removeEventListener","name","addEventListener","transitionFinishTimeout","percent","cancelAnimationFrame","animationFrame","requestAnimationFrame","style","transform","children","className","layout","before","after","resolvedLayout","getInnerRef","onTouchStart","onTouchMoveX","onTouchEnd","context","window","viewWidth","SMALL_TABLET","any","document"],"mappings":"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","sourcesContent":["import React, { HTMLAttributes, MouseEvent, PureComponent } from 'react';\nimport PropTypes from 'prop-types';\nimport withPlatform from '../../hoc/withPlatform';\nimport FixedLayout from '../FixedLayout/FixedLayout';\nimport Touch, { TouchEvent } from '../Touch/Touch';\nimport classNames from '../../lib/classNames';\nimport { HasPlatform } from '../../types';\nimport getClassname from '../../helpers/getClassName';\nimport { canUseDOM } from '../../lib/dom';\nimport { transitionEvent } from '../../lib/supportEvents';\nimport { ANDROID, VKCOM } from '../../lib/platform';\nimport { rubber } from '../../lib/touch';\nimport withAdaptivity, { AdaptivityProps, ViewWidth } from '../../hoc/withAdaptivity';\nimport Text from '../Typography/Text/Text';\nimport Button from '../Button/Button';\nimport { AppRootPortal } from '../AppRoot/AppRootPortal';\n\nexport interface SnackbarProps extends HTMLAttributes<HTMLElement>, HasPlatform, AdaptivityProps {\n  /**\n   * Название кнопки действия в уведомлении\n   */\n  action?: string | React.ComponentType;\n\n  /**\n   * Будет вызвано при клике на кнопку действия\n   */\n  onActionClick?: (e: React.MouseEvent) => void;\n\n  /**\n   * Цветная иконка 24x24 пикселя\n   */\n  before?: React.ReactNode;\n  /**\n   * Контент в правой части, может быть `<Avatar size={32} />`\n   */\n  after?: React.ReactNode;\n  /**\n   * Варианты расположения кнопки\n   */\n  layout?: 'vertical' | 'horizontal';\n  /**\n   * Время в миллисекундах, через которое плашка скроется\n   */\n  duration?: number;\n  /**\n   * Обработчик закрытия уведомления\n   */\n  onClose: () => void;\n}\n\nexport interface SnackbarState {\n  closing: boolean;\n  touched: boolean;\n}\n\nclass Snackbar extends PureComponent<SnackbarProps, SnackbarState> {\n  constructor(props: SnackbarProps) {\n    super(props);\n\n    this.state = {\n      closing: false,\n      touched: false,\n    };\n\n    this.bodyElRef = React.createRef();\n\n    this.shiftXPercent = 0;\n    this.shiftXCurrent = 0;\n  }\n\n  static defaultProps = {\n    duration: 4000,\n    layout: 'horizontal',\n  };\n\n  static contextTypes = {\n    window: PropTypes.any,\n    document: PropTypes.any,\n  };\n\n  private innerEl: HTMLDivElement;\n  private readonly bodyElRef: React.RefObject<HTMLDivElement>;\n\n  private shiftXPercent: number;\n  private shiftXCurrent: number;\n  private touchStartTime: Date;\n  private animationFrame: number;\n\n  private closeTimeout: ReturnType<typeof setTimeout>;\n  private transitionFinishTimeout: ReturnType<typeof setTimeout>;\n\n  componentDidMount() {\n    this.setCloseTimeout();\n  }\n\n  componentWillUnmount() {\n    this.clearCloseTimeout();\n  }\n\n  get window() {\n    return this.context.window || window;\n  }\n\n  setCloseTimeout = () => {\n    if (canUseDOM) {\n      this.closeTimeout = setTimeout(() => {\n        this.close();\n      }, this.props.duration);\n    }\n  };\n\n  clearCloseTimeout = () => {\n    clearTimeout(this.closeTimeout);\n  };\n\n  private readonly onActionClick = (e: MouseEvent) => {\n    this.close();\n\n    if (this.props.action && typeof this.props.onActionClick === 'function') {\n      this.props.onActionClick(e);\n    }\n  };\n\n  close() {\n    this.setState({ closing: true });\n    this.waitTransitionFinish(this.innerEl, () => {\n      this.props.onClose();\n    });\n  }\n\n  waitTransitionFinish(element: HTMLElement, eventHandler: VoidFunction) {\n    if (element) {\n      if (transitionEvent.supported) {\n        element.removeEventListener(transitionEvent.name, eventHandler);\n        element.addEventListener(transitionEvent.name, eventHandler);\n      } else {\n        clearTimeout(this.transitionFinishTimeout);\n        this.transitionFinishTimeout = setTimeout(eventHandler, this.props.platform === ANDROID || this.props.platform === VKCOM ? 400 : 320);\n      }\n    }\n  }\n\n  getInnerRef = (el: HTMLDivElement) => this.innerEl = el;\n\n  onTouchStart = () => {\n    this.clearCloseTimeout();\n  };\n\n  onTouchMoveX = (event: TouchEvent) => {\n    const { shiftX, startT, originalEvent } = event;\n    originalEvent.preventDefault();\n\n    if (!this.state.touched) {\n      this.setState({ touched: true });\n    }\n\n    this.shiftXPercent = shiftX / this.bodyElRef.current.offsetWidth * 100;\n    this.shiftXCurrent = rubber(this.shiftXPercent, 72, 1.2, this.props.platform === ANDROID || this.props.platform === VKCOM);\n    this.touchStartTime = startT;\n\n    this.setBodyTransform(this.shiftXCurrent);\n  };\n\n  onTouchEnd = () => {\n    const newState = {\n      touched: false,\n    };\n\n    let callback;\n\n    if (this.state.touched) {\n      let shiftXCurrent = this.shiftXCurrent;\n      const expectTranslateY = shiftXCurrent / (Date.now() - this.touchStartTime.getTime()) * 240 * 0.6;\n      shiftXCurrent = shiftXCurrent + expectTranslateY;\n\n      if (this.isDesktop && shiftXCurrent <= -50) {\n        this.clearCloseTimeout();\n        this.waitTransitionFinish(this.bodyElRef.current, () => {\n          this.props.onClose();\n        });\n        this.setBodyTransform(-120);\n      } else if (!this.isDesktop && shiftXCurrent >= 50) {\n        this.clearCloseTimeout();\n        this.waitTransitionFinish(this.bodyElRef.current, () => {\n          this.props.onClose();\n        });\n        this.setBodyTransform(120);\n      } else {\n        callback = () => {\n          this.setCloseTimeout();\n          this.setBodyTransform(0);\n        };\n      }\n    } else {\n      this.setCloseTimeout();\n    }\n\n    this.setState(newState, callback);\n  };\n\n  setBodyTransform(percent: number) {\n    cancelAnimationFrame(this.animationFrame);\n    this.animationFrame = requestAnimationFrame(() => {\n      this.bodyElRef.current.style.transform = `translate3d(${percent}%, 0, 0)`;\n    });\n  }\n\n  get isDesktop() {\n    return this.props.viewWidth >= ViewWidth.SMALL_TABLET;\n  }\n\n  render() {\n    const {\n      children,\n      className,\n      platform,\n      layout,\n      action,\n      before,\n      after,\n    } = this.props;\n    const resolvedLayout = after || this.isDesktop ? 'vertical' : layout;\n\n    return (\n      <AppRootPortal>\n        <FixedLayout\n          vertical=\"bottom\"\n          className={classNames(getClassname('Snackbar', platform), className, `Snackbar--l-${resolvedLayout}`, {\n            'Snackbar--closing': this.state.closing,\n            'Snackbar--touched': this.state.touched,\n            'Snackbar--desktop': this.isDesktop,\n          })}\n        >\n          <Touch\n            className=\"Snackbar__in\"\n            getRootRef={this.getInnerRef}\n            onStart={this.onTouchStart}\n            onMoveX={this.onTouchMoveX}\n            onEnd={this.onTouchEnd}\n          >\n            <div className=\"Snackbar__body\" ref={this.bodyElRef}>\n              {before &&\n              <div className=\"Snackbar__before\">\n                {before}\n              </div>}\n\n              <div className=\"Snackbar__content\">\n                <Text weight=\"regular\" className=\"Snackbar__content-text\">{children}</Text>\n\n                {action &&\n                <Button align=\"left\" hasHover={false} mode=\"tertiary\" size=\"s\" className=\"Snackbar__action\" onClick={this.onActionClick}>\n                  {action}\n                </Button>}\n              </div>\n\n              {after &&\n              <div className=\"Snackbar__after\">\n                {after}\n              </div>}\n            </div>\n          </Touch>\n        </FixedLayout>\n      </AppRootPortal>\n    );\n  }\n}\n\nexport default withPlatform(withAdaptivity(Snackbar, {\n  viewWidth: true,\n}));\n"],"file":"Snackbar.js"}