{"ast":null,"code":"import _defineProperty from\"C:\\\\Users\\\\rshub\\\\Desktop\\\\Road-to-Jedi\\\\mobile-road\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";import _classCallCheck from\"C:\\\\Users\\\\rshub\\\\Desktop\\\\Road-to-Jedi\\\\mobile-road\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\rshub\\\\Desktop\\\\Road-to-Jedi\\\\mobile-road\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _inherits from\"C:\\\\Users\\\\rshub\\\\Desktop\\\\Road-to-Jedi\\\\mobile-road\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"C:\\\\Users\\\\rshub\\\\Desktop\\\\Road-to-Jedi\\\\mobile-road\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import React from'react';import{Panel,PanelHeader,PanelHeaderButton,Button,Alert,ScreenSpinner,Input,FormLayout,Textarea}from'@vkontakte/vkui';import Icon24BrowserBack from'@vkontakte/icons/dist/24/browser_back';var NewTicket=/*#__PURE__*/function(_React$Component){_inherits(NewTicket,_React$Component);var _super=_createSuper(NewTicket);function NewTicket(props){var _this;_classCallCheck(this,NewTicket);_this=_super.call(this,props);_this.state={api_url:\"https://xelene.ru/road/php/index.php?\",title_new_tiket:'',text_new_tiket:''};_this.onChange=function(event){var name=event.currentTarget.name;var value=event.currentTarget.value;_this.setState(_defineProperty({},name,value));};return _this;}_createClass(NewTicket,[{key:\"sendNewTiket\",value:function sendNewTiket(){var _this3=this;this.setState({popout:/*#__PURE__*/React.createElement(ScreenSpinner,null)});var global=this;if(this.state.text_new_tiket.length>5||this.state.title_new_tiket.length>5){var url=this.state.api_url+'method=ticket.add&'+window.location.search.replace('?','');var method='POST';var async=true;var xhr=new XMLHttpRequest();xhr.open(method,url,async);//.then(response => response.json())\nxhr.setRequestHeader(\"Content-type\",\"application/x-www-form-urlencoded\");xhr.onreadystatechange=function(){var _this2=this;//Вызывает функцию при смене состояния.\nif(xhr.readyState===XMLHttpRequest.DONE&&xhr.status===200){if(xhr.responseText){var text=JSON.parse(xhr.responseText);global.props.this.goTiket(text.response.ticket_id);fetch(global.state.api_url+\"method=tickets.get&unanswered=1&\"+window.location.search.replace('?','')).then(function(res){return res.json();}).then(function(data){if(data.result){global.setState({tiket_all:data.response,popout:null,title_new_tiket:\"\",text_new_tiket:\"\"});}else{_this2.showErrorAlert(data.error.message);}}).catch(function(err){_this2.showErrorAlert();});}}};xhr.send('title='+this.state.title_new_tiket+'&text='+this.state.text_new_tiket);xhr.onerror=function(error){_this3.showErrorAlert();console.error(error);};}else{this.setState({popout:/*#__PURE__*/React.createElement(Alert,{actions:[{title:'Отмена',autoclose:true,style:'cancel'}],onClose:this.closePopout},/*#__PURE__*/React.createElement(\"h2\",null,\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430\"),/*#__PURE__*/React.createElement(\"p\",null,\"\\u0417\\u0430\\u0433\\u043E\\u043B\\u043E\\u0432\\u043E\\u043A \\u0438\\u043B\\u0438 \\u0442\\u0435\\u043A\\u0441\\u0442 \\u043F\\u0440\\u043E\\u0431\\u043B\\u0435\\u043C\\u044B \\u0434\\u043E\\u043B\\u0436\\u0435\\u043D \\u0431\\u044B\\u0442\\u044C \\u0431\\u043E\\u043B\\u044C\\u0448\\u0435 5 \\u0441\\u0438\\u043C\\u0432\\u043E\\u043B\\u043E\\u0432.\"))});}}},{key:\"render\",value:function render(){var _this4=this;return/*#__PURE__*/React.createElement(Panel,{id:this.props.id},/*#__PURE__*/React.createElement(PanelHeader,{left:/*#__PURE__*/React.createElement(PanelHeaderButton,{onClick:function onClick(){return window.history.back();}},/*#__PURE__*/React.createElement(Icon24BrowserBack,null))},\"\\u041D\\u043E\\u0432\\u044B\\u0439 \\u0432\\u043E\\u043F\\u0440\\u043E\\u0441\"),/*#__PURE__*/React.createElement(FormLayout,null,/*#__PURE__*/React.createElement(Input,{top:this.state.title_new_tiket===null?\"Суть проблемы (0/30). Не менее 5 символов\":\"Суть проблемы (\"+this.state.title_new_tiket.length+\"/80). Не менее 5 символов\",maxLength:\"80\",type:\"text\",name:\"title_new_tiket\",value:this.state.title_new_tiket,onChange:function onChange(e){return _this4.onChange(e);}}),/*#__PURE__*/React.createElement(Textarea,{maxLength:\"2020\",name:\"text_new_tiket\",top:this.state.text_new_tiket===null?\"Подробнее о проблеме (0/2020). Не менее 5 символов\":\"Подробнее о проблеме (\"+this.state.text_new_tiket.length+\"/2020). Не менее 5 символов\",onChange:function onChange(e){return _this4.onChange(e);},value:this.state.text_new_tiket}),/*#__PURE__*/React.createElement(Button,{size:\"xl\",level:\"secondary\",stretched:true,disabled:!Boolean(this.state.text_new_tiket.length>5)||!Boolean(this.state.title_new_tiket.length>5),onClick:function onClick(){_this4.sendNewTiket();}},\"\\u041E\\u0442\\u043F\\u0440\\u0430\\u0432\\u0438\\u0442\\u044C\")));}}]);return NewTicket;}(React.Component);export{NewTicket as default};","map":{"version":3,"sources":["C:/Users/rshub/Desktop/Road-to-Jedi/mobile-road/src/panels/questions/panels/new_tiket.js"],"names":["React","Panel","PanelHeader","PanelHeaderButton","Button","Alert","ScreenSpinner","Input","FormLayout","Textarea","Icon24BrowserBack","NewTicket","props","state","api_url","title_new_tiket","text_new_tiket","onChange","event","name","currentTarget","value","setState","popout","global","length","url","window","location","search","replace","method","async","xhr","XMLHttpRequest","open","setRequestHeader","onreadystatechange","readyState","DONE","status","responseText","text","JSON","parse","this","goTiket","response","ticket_id","fetch","then","res","json","data","result","tiket_all","showErrorAlert","error","message","catch","err","send","onerror","console","title","autoclose","style","closePopout","id","history","back","e","Boolean","sendNewTiket","Component"],"mappings":"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","sourcesContent":["import React from 'react';\n\nimport { \n    Panel,\n    PanelHeader,\n    PanelHeaderButton,\n    Button,\n    Alert,\n    ScreenSpinner,\n    Input,\n    FormLayout,\n    Textarea,\n    } from '@vkontakte/vkui';\n\n\nimport Icon24BrowserBack from '@vkontakte/icons/dist/24/browser_back';\n\nexport default class NewTicket extends React.Component {\n        constructor(props) {\n            super(props);\n            this.state = {\n                api_url: \"https://xelene.ru/road/php/index.php?\",\n                title_new_tiket: '',\n                text_new_tiket: '',\n            }\n            this.onChange = (event) => {\n                var name = event.currentTarget.name;\n                var value = event.currentTarget.value;\n                this.setState({ [name]: value });\n            }\n        }\n        sendNewTiket() {\n        this.setState({popout: <ScreenSpinner/>})\n        var global = this;\n        if(this.state.text_new_tiket.length > 5 || this.state.title_new_tiket.length > 5) {\n            var url = this.state.api_url + 'method=ticket.add&' + window.location.search.replace('?', '');\n            var method = 'POST';\n            var async = true;\n        \n            var xhr = new XMLHttpRequest();\n            xhr.open( method, url, async );\n            //.then(response => response.json())\n            \n            xhr.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\n        \n            xhr.onreadystatechange = function() {//Вызывает функцию при смене состояния.\n            if(xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {\n                if(xhr.responseText) {\n                let text = (JSON.parse(xhr.responseText));\n                global.props.this.goTiket(text.response.ticket_id)\n                fetch(global.state.api_url + \"method=tickets.get&unanswered=1&\" + window.location.search.replace('?', ''))\n                .then(res => res.json())\n                .then(data => {\n                    if(data.result) {\n                        global.setState({tiket_all: data.response, popout: null, title_new_tiket: \"\", text_new_tiket: \"\"})\n                    }else{\n                        this.showErrorAlert(data.error.message)\n                    }\n                })\n                .catch(err => {\n                    this.showErrorAlert()\n\n                })\n                }\n            }\n        }\n            \n            xhr.send( 'title=' + this.state.title_new_tiket + '&text=' + this.state.text_new_tiket );\n            xhr.onerror = ( error ) => {\n            this.showErrorAlert()\n\n            console.error( error );\n            }\n        } else {\n            this.setState({\n            popout: \n            <Alert\n            actions={[{\n            title: 'Отмена',\n            autoclose: true,\n            style: 'cancel'\n            }]}\n            onClose={this.closePopout}\n        >\n            <h2>Ошибка</h2>\n            <p>Заголовок или текст проблемы должен быть больше 5 символов.</p>\n        </Alert>\n            })\n        }\n        }\n\n        render() {\n            return (\n                <Panel id={this.props.id}>\n                <PanelHeader \n                    left={\n                    <PanelHeaderButton onClick={() => window.history.back()}> \n                    <Icon24BrowserBack/>\n                    </PanelHeaderButton>\n                    }>\n                Новый вопрос\n                </PanelHeader>\n                <FormLayout>\n                    <Input \n                    top={this.state.title_new_tiket === null ? \"Суть проблемы (0/30). Не менее 5 символов\" : \"Суть проблемы (\" + this.state.title_new_tiket.length + \"/80). Не менее 5 символов\"}\n                    maxLength=\"80\" \n                    type=\"text\" \n                    name=\"title_new_tiket\" \n                    value={this.state.title_new_tiket} \n                    onChange={(e) => this.onChange(e)}/>\n\n                    <Textarea maxLength=\"2020\" \n                    name=\"text_new_tiket\" \n                    top={this.state.text_new_tiket === null ? \"Подробнее о проблеме (0/2020). Не менее 5 символов\" : \"Подробнее о проблеме (\" + this.state.text_new_tiket.length + \"/2020). Не менее 5 символов\"} \n                    onChange={(e) => this.onChange(e)}\n                    value={this.state.text_new_tiket}\n                    ></Textarea>\n                    <Button\n                    size=\"xl\" \n                    level=\"secondary\" \n                    stretched \n                    disabled={!Boolean(this.state.text_new_tiket.length > 5) || !Boolean(this.state.title_new_tiket.length > 5)}\n                    onClick={\n                        () => {\n                            this.sendNewTiket();\n                        }\n                    }>Отправить</Button>\n                </FormLayout>\n            </Panel>\n            )\n            }\n        }\n  "]},"metadata":{},"sourceType":"module"}