{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\rshub\\\\Desktop\\\\Road-to-Jedi\\\\mobile-road\\\\src\\\\panels\\\\questions\\\\panels\\\\new_tiket.js\";\nimport React from 'react';\nimport { Panel, PanelHeader, PanelHeaderButton, Button, Alert, ScreenSpinner, Input, FormLayout, Textarea } from '@vkontakte/vkui';\nimport Icon24BrowserBack from '@vkontakte/icons/dist/24/browser_back';\nexport default class NewTicket extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      api_url: \"https://xelene.ru/road/php/index.php?\",\n      title_new_tiket: '',\n      text_new_tiket: ''\n    };\n\n    this.onChange = event => {\n      var name = event.currentTarget.name;\n      var value = event.currentTarget.value;\n      this.setState({\n        [name]: value\n      });\n    };\n  }\n\n  getRandomInRange(min, max) {\n    return Math.floor(Math.random() * (max - min + 1)) + min;\n  }\n\n  sendNewTiket() {\n    this.setState({\n      popout: /*#__PURE__*/React.createElement(ScreenSpinner, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 36,\n          columnNumber: 32\n        }\n      })\n    });\n    var global = this;\n\n    if (this.state.text_new_tiket.length > 5 || this.state.title_new_tiket.length > 5) {\n      var url = this.state.api_url + 'method=ticket.add&' + window.location.search.replace('?', '');\n      var method = 'POST';\n      var async = true;\n      var xhr = new XMLHttpRequest();\n      xhr.open(method, url, async); //.then(response => response.json())\n\n      xhr.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\n\n      xhr.onreadystatechange = function () {\n        //Вызывает функцию при смене состояния.\n        if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {\n          if (xhr.responseText) {\n            let text = JSON.parse(xhr.responseText);\n            global.props.this.goTiket(text.response.ticket_id);\n            fetch(global.state.api_url + \"method=tickets.get&unanswered=1&\" + window.location.search.replace('?', '')).then(res => res.json()).then(data => {\n              if (data.result) {\n                global.setState({\n                  tiket_all: data.response,\n                  popout: null,\n                  title_new_tiket: \"\",\n                  text_new_tiket: \"\"\n                });\n              } else {\n                this.showErrorAlert(data.error.message);\n              }\n            }).catch(err => {\n              this.showErrorAlert();\n            });\n          }\n        }\n      };\n\n      xhr.send('title=' + this.state.title_new_tiket + '&text=' + this.state.text_new_tiket + '&user=' + this.getRandomInRange(501, 624429367));\n\n      xhr.onerror = error => {\n        this.showErrorAlert();\n        console.error(error);\n      };\n    } else {\n      this.setState({\n        popout: /*#__PURE__*/React.createElement(Alert, {\n          actions: [{\n            title: 'Отмена',\n            autoclose: true,\n            style: 'cancel'\n          }],\n          onClose: this.closePopout,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 80,\n            columnNumber: 13\n          }\n        }, /*#__PURE__*/React.createElement(\"h2\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 88,\n            columnNumber: 13\n          }\n        }, \"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430\"), /*#__PURE__*/React.createElement(\"p\", {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 89,\n            columnNumber: 13\n          }\n        }, \"\\u0417\\u0430\\u0433\\u043E\\u043B\\u043E\\u0432\\u043E\\u043A \\u0438\\u043B\\u0438 \\u0442\\u0435\\u043A\\u0441\\u0442 \\u043F\\u0440\\u043E\\u0431\\u043B\\u0435\\u043C\\u044B \\u0434\\u043E\\u043B\\u0436\\u0435\\u043D \\u0431\\u044B\\u0442\\u044C \\u0431\\u043E\\u043B\\u044C\\u0448\\u0435 5 \\u0441\\u0438\\u043C\\u0432\\u043E\\u043B\\u043E\\u0432.\"))\n      });\n    }\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(Panel, {\n      id: this.props.id,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 97,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(PanelHeader, {\n      left: /*#__PURE__*/React.createElement(PanelHeaderButton, {\n        onClick: () => window.history.back(),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 100,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(Icon24BrowserBack, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 101,\n          columnNumber: 21\n        }\n      })),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 98,\n        columnNumber: 17\n      }\n    }, \"\\u041D\\u043E\\u0432\\u044B\\u0439 \\u0432\\u043E\\u043F\\u0440\\u043E\\u0441\"), /*#__PURE__*/React.createElement(FormLayout, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(Input, {\n      top: this.state.title_new_tiket === null ? \"Суть проблемы (0/30). Не менее 5 символов\" : \"Суть проблемы (\" + this.state.title_new_tiket.length + \"/80). Не менее 5 символов\",\n      maxLength: \"80\",\n      type: \"text\",\n      name: \"title_new_tiket\",\n      value: this.state.title_new_tiket,\n      onChange: e => this.onChange(e),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 21\n      }\n    }), /*#__PURE__*/React.createElement(Textarea, {\n      maxLength: \"2020\",\n      name: \"text_new_tiket\",\n      top: this.state.text_new_tiket === null ? \"Подробнее о проблеме (0/2020). Не менее 5 символов\" : \"Подробнее о проблеме (\" + this.state.text_new_tiket.length + \"/2020). Не менее 5 символов\",\n      onChange: e => this.onChange(e),\n      value: this.state.text_new_tiket,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 116,\n        columnNumber: 21\n      }\n    }), /*#__PURE__*/React.createElement(Button, {\n      size: \"xl\",\n      level: \"secondary\",\n      stretched: true,\n      disabled: !Boolean(this.state.text_new_tiket.length > 5) || !Boolean(this.state.title_new_tiket.length > 5),\n      onClick: () => {\n        this.sendNewTiket();\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 122,\n        columnNumber: 21\n      }\n    }, \"\\u041E\\u0442\\u043F\\u0440\\u0430\\u0432\\u0438\\u0442\\u044C\")));\n  }\n\n}","map":{"version":3,"sources":["C:/Users/rshub/Desktop/Road-to-Jedi/mobile-road/src/panels/questions/panels/new_tiket.js"],"names":["React","Panel","PanelHeader","PanelHeaderButton","Button","Alert","ScreenSpinner","Input","FormLayout","Textarea","Icon24BrowserBack","NewTicket","Component","constructor","props","state","api_url","title_new_tiket","text_new_tiket","onChange","event","name","currentTarget","value","setState","getRandomInRange","min","max","Math","floor","random","sendNewTiket","popout","global","length","url","window","location","search","replace","method","async","xhr","XMLHttpRequest","open","setRequestHeader","onreadystatechange","readyState","DONE","status","responseText","text","JSON","parse","this","goTiket","response","ticket_id","fetch","then","res","json","data","result","tiket_all","showErrorAlert","error","message","catch","err","send","onerror","console","title","autoclose","style","closePopout","render","id","history","back","e","Boolean"],"mappings":"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","sourcesContent":["import React from 'react';\n\nimport { \n    Panel,\n    PanelHeader,\n    PanelHeaderButton,\n    Button,\n    Alert,\n    ScreenSpinner,\n    Input,\n    FormLayout,\n    Textarea,\n    } from '@vkontakte/vkui';\n\n\nimport Icon24BrowserBack from '@vkontakte/icons/dist/24/browser_back';\n\nexport default class NewTicket extends React.Component {\n        constructor(props) {\n            super(props);\n            this.state = {\n                api_url: \"https://xelene.ru/road/php/index.php?\",\n                title_new_tiket: '',\n                text_new_tiket: '',\n            }\n            this.onChange = (event) => {\n                var name = event.currentTarget.name;\n                var value = event.currentTarget.value;\n                this.setState({ [name]: value });\n            }\n        }\n        getRandomInRange(min, max) {\n            return Math.floor(Math.random() * (max - min + 1)) + min;\n          }\n        sendNewTiket() {\n        this.setState({popout: <ScreenSpinner/>})\n        var global = this;\n        if(this.state.text_new_tiket.length > 5 || this.state.title_new_tiket.length > 5) {\n            var url = this.state.api_url + 'method=ticket.add&' + window.location.search.replace('?', '');\n            var method = 'POST';\n            var async = true;\n        \n            var xhr = new XMLHttpRequest();\n            xhr.open( method, url, async );\n            //.then(response => response.json())\n            \n            xhr.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\n        \n            xhr.onreadystatechange = function() {//Вызывает функцию при смене состояния.\n            if(xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {\n                if(xhr.responseText) {\n                let text = (JSON.parse(xhr.responseText));\n                global.props.this.goTiket(text.response.ticket_id)\n                fetch(global.state.api_url + \"method=tickets.get&unanswered=1&\" + window.location.search.replace('?', ''))\n                .then(res => res.json())\n                .then(data => {\n                    if(data.result) {\n                        global.setState({tiket_all: data.response, popout: null, title_new_tiket: \"\", text_new_tiket: \"\"})\n                    }else{\n                        this.showErrorAlert(data.error.message)\n                    }\n                })\n                .catch(err => {\n                    this.showErrorAlert()\n\n                })\n                }\n            }\n        }\n            \n            xhr.send( 'title=' + this.state.title_new_tiket + '&text=' + this.state.text_new_tiket + '&user=' + this.getRandomInRange(501, 624429367) );\n            xhr.onerror = ( error ) => {\n            this.showErrorAlert()\n\n            console.error( error );\n            }\n        } else {\n            this.setState({\n            popout: \n            <Alert\n            actions={[{\n            title: 'Отмена',\n            autoclose: true,\n            style: 'cancel'\n            }]}\n            onClose={this.closePopout}\n        >\n            <h2>Ошибка</h2>\n            <p>Заголовок или текст проблемы должен быть больше 5 символов.</p>\n        </Alert>\n            })\n        }\n        }\n\n        render() {\n            return (\n                <Panel id={this.props.id}>\n                <PanelHeader \n                    left={\n                    <PanelHeaderButton onClick={() => window.history.back()}> \n                    <Icon24BrowserBack/>\n                    </PanelHeaderButton>\n                    }>\n                Новый вопрос\n                </PanelHeader>\n                <FormLayout>\n                    <Input \n                    top={this.state.title_new_tiket === null ? \"Суть проблемы (0/30). Не менее 5 символов\" : \"Суть проблемы (\" + this.state.title_new_tiket.length + \"/80). Не менее 5 символов\"}\n                    maxLength=\"80\" \n                    type=\"text\" \n                    name=\"title_new_tiket\" \n                    \n                    value={this.state.title_new_tiket} \n                    onChange={(e) => this.onChange(e)}/>\n\n                    <Textarea maxLength=\"2020\" \n                    name=\"text_new_tiket\" \n                    top={this.state.text_new_tiket === null ? \"Подробнее о проблеме (0/2020). Не менее 5 символов\" : \"Подробнее о проблеме (\" + this.state.text_new_tiket.length + \"/2020). Не менее 5 символов\"} \n                    onChange={(e) => this.onChange(e)}\n                    value={this.state.text_new_tiket}\n                    ></Textarea>\n                    <Button\n                    size=\"xl\" \n                    level=\"secondary\" \n                    stretched \n                    disabled={!Boolean(this.state.text_new_tiket.length > 5) || !Boolean(this.state.title_new_tiket.length > 5)}\n                    onClick={\n                        () => {\n                            this.sendNewTiket();\n                        }\n                    }>Отправить</Button>\n                </FormLayout>\n            </Panel>\n            )\n            }\n        }\n  "]},"metadata":{},"sourceType":"module"}