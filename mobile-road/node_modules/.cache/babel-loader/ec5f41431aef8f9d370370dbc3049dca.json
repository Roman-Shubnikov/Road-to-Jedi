{"ast":null,"code":"import _defineProperty from\"C:\\\\Users\\\\rshub\\\\Desktop\\\\Road-to-Jedi\\\\mobile-road\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";import _classCallCheck from\"C:\\\\Users\\\\rshub\\\\Desktop\\\\Road-to-Jedi\\\\mobile-road\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\rshub\\\\Desktop\\\\Road-to-Jedi\\\\mobile-road\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _assertThisInitialized from\"C:\\\\Users\\\\rshub\\\\Desktop\\\\Road-to-Jedi\\\\mobile-road\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/assertThisInitialized\";import _inherits from\"C:\\\\Users\\\\rshub\\\\Desktop\\\\Road-to-Jedi\\\\mobile-road\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"C:\\\\Users\\\\rshub\\\\Desktop\\\\Road-to-Jedi\\\\mobile-road\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import React from'react';import{Panel,PanelHeader,PanelHeaderButton,Button,Alert,ScreenSpinner,Input,FormLayout,Textarea}from'@vkontakte/vkui';import Icon24BrowserBack from'@vkontakte/icons/dist/24/browser_back';var NewTicket=/*#__PURE__*/function(_React$Component){_inherits(NewTicket,_React$Component);var _super=_createSuper(NewTicket);function NewTicket(props){var _this;_classCallCheck(this,NewTicket);_this=_super.call(this,props);_this.state={api_url:\"https://xelene.ru/road/php/index.php?\",title_new_tiket:'',text_new_tiket:''};_this.sendNewTiket=_this.sendNewTiket.bind(_assertThisInitialized(_this));_this.onChange=function(event){var name=event.currentTarget.name;var value=event.currentTarget.value;_this.setState(_defineProperty({},name,value));};return _this;}_createClass(NewTicket,[{key:\"getRandomInRange\",value:function getRandomInRange(min,max){return Math.floor(Math.random()*(max-min+1))+min;}},{key:\"sendNewTiket\",value:function sendNewTiket(){var _this2=this;this.setState({popout:/*#__PURE__*/React.createElement(ScreenSpinner,null)});if(this.state.text_new_tiket.length>5||this.state.title_new_tiket.length>5){fetch(this.state.api_url+\"method=ticket.add&\"+window.location.search.replace('?',''),{method:'post',headers:{\"Content-type\":\"application/json; charset=UTF-8\"},// signal: controllertime.signal,\nbody:JSON.stringify({'title':this.state.title_new_tiket,'text':this.state.text_new_tiket,'user':this.getRandomInRange(501,624429367)})}).then(function(res){return res.json();}).then(function(data){if(data.result){fetch(_this2.state.api_url+\"method=tickets.get&\"+window.location.search.replace('?',''),{method:'post',headers:{\"Content-type\":\"application/json; charset=UTF-8\"},// signal: controllertime.signal,\nbody:JSON.stringify({'unanswered':1})}).then(function(res){return res.json();}).then(function(data){if(data.result){_this2.setState({tiket_all:data.response,popout:null,title_new_tiket:\"\",text_new_tiket:\"\"});}else{_this2.showErrorAlert(data.error.message);}}).catch(function(err){_this2.showErrorAlert('Ошибка запроса. Пожалуйста, попробуйте позже',function(){_this2.changeData('activeStory','disconnect');});});}else{_this2.showErrorAlert(data.error.message);}}).catch(function(err){_this2.showErrorAlert('Ошибка запроса. Пожалуйста, попробуйте позже',function(){_this2.changeData('activeStory','disconnect');});});}else{this.setState({popout:/*#__PURE__*/React.createElement(Alert,{actions:[{title:'Отмена',autoclose:true,style:'cancel'}],onClose:this.closePopout},/*#__PURE__*/React.createElement(\"h2\",null,\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430\"),/*#__PURE__*/React.createElement(\"p\",null,\"\\u0417\\u0430\\u0433\\u043E\\u043B\\u043E\\u0432\\u043E\\u043A \\u0438\\u043B\\u0438 \\u0442\\u0435\\u043A\\u0441\\u0442 \\u043F\\u0440\\u043E\\u0431\\u043B\\u0435\\u043C\\u044B \\u0434\\u043E\\u043B\\u0436\\u0435\\u043D \\u0431\\u044B\\u0442\\u044C \\u0431\\u043E\\u043B\\u044C\\u0448\\u0435 5 \\u0441\\u0438\\u043C\\u0432\\u043E\\u043B\\u043E\\u0432.\"))});}}},{key:\"render\",value:function render(){var _this3=this;return/*#__PURE__*/React.createElement(Panel,{id:this.props.id},/*#__PURE__*/React.createElement(PanelHeader,{left:/*#__PURE__*/React.createElement(PanelHeaderButton,{onClick:function onClick(){return window.history.back();}},/*#__PURE__*/React.createElement(Icon24BrowserBack,null))},\"\\u041D\\u043E\\u0432\\u044B\\u0439 \\u0432\\u043E\\u043F\\u0440\\u043E\\u0441\"),/*#__PURE__*/React.createElement(FormLayout,null,/*#__PURE__*/React.createElement(Input,{top:this.state.title_new_tiket===null?\"Суть проблемы (0/30). Не менее 5 символов\":\"Суть проблемы (\"+this.state.title_new_tiket.length+\"/80). Не менее 5 символов\",maxLength:\"80\",type:\"text\",name:\"title_new_tiket\",placeholder:\"\\u0412\\u0432\\u0435\\u0434\\u0438\\u0442\\u0435 \\u0441\\u0432\\u043E\\u0439 \\u0442\\u0435\\u043A\\u0441\\u0442...\",value:this.state.title_new_tiket,onChange:function onChange(e){return _this3.onChange(e);}}),/*#__PURE__*/React.createElement(Textarea,{maxLength:\"2020\",name:\"text_new_tiket\",top:this.state.text_new_tiket===null?\"Подробнее о проблеме (0/2020). Не менее 5 символов\":\"Подробнее о проблеме (\"+this.state.text_new_tiket.length+\"/2020). Не менее 5 символов\",onChange:function onChange(e){return _this3.onChange(e);},placeholder:\"\\u0412\\u0432\\u0435\\u0434\\u0438\\u0442\\u0435 \\u0441\\u0432\\u043E\\u0439 \\u0442\\u0435\\u043A\\u0441\\u0442...\",value:this.state.text_new_tiket}),/*#__PURE__*/React.createElement(Button,{size:\"xl\",level:\"secondary\",stretched:true,disabled:!Boolean(this.state.text_new_tiket.length>5)||!Boolean(this.state.title_new_tiket.length>5),onClick:function onClick(){_this3.sendNewTiket();}},\"\\u041E\\u0442\\u043F\\u0440\\u0430\\u0432\\u0438\\u0442\\u044C\")));}}]);return NewTicket;}(React.Component);export{NewTicket as default};","map":{"version":3,"sources":["C:/Users/rshub/Desktop/Road-to-Jedi/mobile-road/src/panels/questions/panels/new_tiket.js"],"names":["React","Panel","PanelHeader","PanelHeaderButton","Button","Alert","ScreenSpinner","Input","FormLayout","Textarea","Icon24BrowserBack","NewTicket","props","state","api_url","title_new_tiket","text_new_tiket","sendNewTiket","bind","onChange","event","name","currentTarget","value","setState","min","max","Math","floor","random","popout","length","fetch","window","location","search","replace","method","headers","body","JSON","stringify","getRandomInRange","then","res","json","data","result","tiket_all","response","showErrorAlert","error","message","catch","err","changeData","title","autoclose","style","closePopout","id","history","back","e","Boolean","Component"],"mappings":"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","sourcesContent":["import React from 'react';\n\nimport { \n    Panel,\n    PanelHeader,\n    PanelHeaderButton,\n    Button,\n    Alert,\n    ScreenSpinner,\n    Input,\n    FormLayout,\n    Textarea,\n    } from '@vkontakte/vkui';\n\n\nimport Icon24BrowserBack from '@vkontakte/icons/dist/24/browser_back';\n\nexport default class NewTicket extends React.Component {\n        constructor(props) {\n            super(props);\n            this.state = {\n                api_url: \"https://xelene.ru/road/php/index.php?\",\n                title_new_tiket: '',\n                text_new_tiket: '',\n            }\n            this.sendNewTiket = this.sendNewTiket.bind(this);\n            this.onChange = (event) => {\n                var name = event.currentTarget.name;\n                var value = event.currentTarget.value;\n                this.setState({ [name]: value });\n            }\n        }\n        getRandomInRange(min, max) {\n            return Math.floor(Math.random() * (max - min + 1)) + min;\n          }\n        sendNewTiket() {\n            this.setState({popout: <ScreenSpinner/>})\n            if(this.state.text_new_tiket.length > 5 || this.state.title_new_tiket.length > 5) {\n                fetch(this.state.api_url + \"method=ticket.add&\" + window.location.search.replace('?', ''), \n                {method: 'post',\n                headers: {\"Content-type\": \"application/json; charset=UTF-8\"},\n                    // signal: controllertime.signal,\n                body: JSON.stringify({\n                    'title': this.state.title_new_tiket,\n                    'text': this.state.text_new_tiket,\n                    'user': this.getRandomInRange(501, 624429367),\n                })\n                })\n                .then(res => res.json())\n                .then(data => {\n                    if(data.result) {\n                        fetch(this.state.api_url + \"method=tickets.get&\" + window.location.search.replace('?', ''),\n                        {method: 'post',\n                        headers: {\"Content-type\": \"application/json; charset=UTF-8\"},\n                            // signal: controllertime.signal,\n                        body: JSON.stringify({\n                            'unanswered': 1,\n                        })\n                        })\n                        .then(res => res.json())\n                        .then(data => {\n                            if(data.result) {\n                                this.setState({tiket_all: data.response, popout: null, title_new_tiket: \"\", text_new_tiket: \"\"})\n                            }else{\n                                this.showErrorAlert(data.error.message)\n                            }\n                        })\n                        .catch(err => {\n                            this.showErrorAlert('Ошибка запроса. Пожалуйста, попробуйте позже',() => {this.changeData('activeStory', 'disconnect')})\n        \n                        })\n                    }else{\n                    this.showErrorAlert(data.error.message)\n                }\n                })\n                .catch(err => {\n                    this.showErrorAlert('Ошибка запроса. Пожалуйста, попробуйте позже',() => {this.changeData('activeStory', 'disconnect')})\n                })\n            }else{\n                this.setState({\n                    popout: \n                    <Alert\n                    actions={[{\n                    title: 'Отмена',\n                    autoclose: true,\n                    style: 'cancel'\n                    }]}\n                    onClose={this.closePopout}\n                >\n                    <h2>Ошибка</h2>\n                    <p>Заголовок или текст проблемы должен быть больше 5 символов.</p>\n                </Alert>\n                    })\n            }\n        }\n\n        render() {\n            return (\n                <Panel id={this.props.id}>\n                <PanelHeader \n                    left={\n                    <PanelHeaderButton onClick={() => window.history.back()}> \n                    <Icon24BrowserBack/>\n                    </PanelHeaderButton>\n                    }>\n                Новый вопрос\n                </PanelHeader>\n                <FormLayout>\n                    <Input \n                    top={this.state.title_new_tiket === null ? \"Суть проблемы (0/30). Не менее 5 символов\" : \"Суть проблемы (\" + this.state.title_new_tiket.length + \"/80). Не менее 5 символов\"}\n                    maxLength=\"80\" \n                    type=\"text\" \n                    name=\"title_new_tiket\" \n                    placeholder='Введите свой текст...'\n                    value={this.state.title_new_tiket} \n                    onChange={(e) => this.onChange(e)}/>\n\n                    <Textarea maxLength=\"2020\" \n                    name=\"text_new_tiket\" \n                    top={this.state.text_new_tiket === null ? \"Подробнее о проблеме (0/2020). Не менее 5 символов\" : \"Подробнее о проблеме (\" + this.state.text_new_tiket.length + \"/2020). Не менее 5 символов\"} \n                    onChange={(e) => this.onChange(e)}\n                    placeholder='Введите свой текст...'\n                    value={this.state.text_new_tiket}\n                    ></Textarea>\n                    <Button\n                    size=\"xl\" \n                    level=\"secondary\" \n                    stretched \n                    disabled={!Boolean(this.state.text_new_tiket.length > 5) || !Boolean(this.state.title_new_tiket.length > 5)}\n                    onClick={\n                        () => {\n                            this.sendNewTiket();\n                        }\n                    }>Отправить</Button>\n                </FormLayout>\n            </Panel>\n            )\n            }\n        }\n  "]},"metadata":{},"sourceType":"module"}